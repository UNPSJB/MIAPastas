{% extends 'base.html' %}
{% load staticfiles %}
{% load bootstrap3 %}
{% block contenido %}
<div class="container">

    <div class="panel panel-default">
        <div class="panel-heading"><p class="text-center login-title"><font face="tahoma" size="4" color="black"><b>Asignar grupos</b></font></p></div>
            <div class="row">
                <form method="get" class="form-inline col-md-12">
                    <div class="form-group">
                        <label>Usuario:</label>
                        <input type="text" class="form-control" value="{{usuario.username}}" name="user" id="user" readonly>
                        <label>Nombre:</label>
                        <input type="text" class="form-control" value="{{usuario.first_name}}" name="nombre" id="nombre" readonly>
                        <label>Apellido:</label>
                        <input type="text" class="form-control" value="{{usuario.last_name}}" name="apellido" id="apellido" readonly>
                        <label>e-mail:</label>
                        <input type="text" class="form-control" value="{{usuario.email}}" name="email" id="email" readonly>
                    </div>
                </form>
            </div>
            <p>&nbsp;</p>

            <div class="row">
                <form method="get" class="form-inline col-md-12">
                    <div class="col-md-6" style="overflow-y:scroll; max-height:350px;">
                        <p>&nbsp;</p>
                              <table class="table table-hover">
                                <thead>
                                <tr>
                                    <th>grupos del ususario</th>
                                </tr>
                                </thead>
                                  <tbody>
                                    {% for grupo in grupos_usuario %}

                                    <tr class="renglon select-item" data-id="{{grupos_usuario.id}}" id="renglon-{{grupos_usuario.id}}"  >
                                        <td>{{grupo}}</td>
                                    </tr>
                                    {% endfor %}
                                  </tbody>
                              </table>
                    </div>

                    <label for="id_grupo">Grupo</label>
                    <select class="form-control" id="id_grupo" name="id_grupo" title="" onchange="refrescar">
                    <option value="" selected="selected">---------</option>
                         {% for i in grupos %}
                             <option value="{{i.id}}">{{i}}</option>
                        {% endfor %}
                    </select>


                    <p>&nbsp;</p>
                </form>
                {% buttons %}
                <button id="agregar-grupo"  class="btn btn-primary" ><span class="glyphicon glyphicon-chevron-left" aria-hidden="true">  Agregar  </span></button>
                <p></p>
                <button id="quitar-grupo" class="btn btn-danger" ><span class="glyphicon glyphicon-chevron-right" aria-hidden="true">  Quitar </span></button>
                {% endbuttons %}
            </div>
        </div>
    </div>
</div>



{% endblock %}



{% block javascript %}
<script>
$(function(){
        var id_usuario = {{usuario.id}};                      //el ususario con que estoy trabajando
        var id_grupo_usuario;                                //grupo del usuario que seleccionado para quitar al usuario
        var id_grupo = Number($("#id_grupo").val());         ///grupo seleccionado para agregar al usurio
        var id;

       function obtenerId(event) {
            var $el = $(this);          //con this se referencia al objeto de clase select-item que ocaciono el evento, el id se define en el html
            id_grupo_usuario = $el.data()["id"];

            $el.addClass("danger");
            var _renglon = "";
            _renglon= "#renglon-"+id_grupo_usuario;
            $(".select-item").removeClass("danger");        //quito la clase active, para q se deseleccionen
            $(_renglon).addClass("danger");
        }

        function refrescar(){
            console.log("entre")
        }

        function quitar(){
            if(id_grupo_usuario == undefined){
                BootstrapDialog.show({
                    title: "Error",
                    cssClass: 'error-dialog',
                    message: "debe seleccionar uno de los grupos del usuario",
                    type: BootstrapDialog.TYPE_DANGER,
                    buttons: [{
                            label: 'Aceptar',
                            action: function(dialogRef){
                                dialogRef.close();
                }}]});
            }else{
                alert("eliminado");
                // window.open('/usuarios/admin/modificar/quitar/grupo/'+id+'',"_self")
                //window.open('/usuarios/admin/modificar/quitar/grupo/'+id_usuario+','+id_grupo_usuario+'',"_self")
        }}


        function agregar(){
            if(id_grupo == 0){
                 BootstrapDialog.show({
                    title: "Error",
                    cssClass: 'error-dialog',
                    message: "debe seleccionar el grupos a agregar",
                    type: BootstrapDialog.TYPE_DANGER,
                    buttons: [{
                            label: 'Aceptar',
                            action: function(dialogRef){
                                dialogRef.close();
                 }}]});
            }else{
                alert("agregado");
                //window.open('/usuarios/admin/modificar/agregar/grupo/'+id+'',"_self")
                //window.open('/usuarios/admin/modificar/agregar/grupo/'+id_ususario+','+id_grupo+'',"_self")
        }}





        $("#refrescar").click(refrescar);
        $(".select-item").click(obtenerId);
        $("#quitar-grupo").click(quitar);
        $("#agregar-grupo").click(agregar);

       });
</script>
{% endblock %}